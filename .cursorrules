# Cursor AI Agent Rules for MFLUX

## ðŸš¨ CRITICAL: Always Use `uv` Commands

**This project uses `uv` for Python package management and command execution.**

**ALWAYS use:**
- `uv run python` instead of `python` or `python3`
- `uv run uvicorn` instead of `uvicorn`
- `uv pip install` instead of `pip install`
- `uv run <command>` for any Python-related commands

**NEVER use bare `python`, `python3`, `pip`, `uvicorn`, etc.**

## ðŸš¨ CRITICAL: Use the Native CLI Commands for Debugging

**ALWAYS use the native CLI commands: `mflux-debug-mlx` or `mflux-debug-pytorch`**

**Installation (one-time setup):**
```bash
cd /Users/filip/Desktop/mflux
uv tool install --editable .
```

**Learn interactively first:**
```bash
mflux-debug-mlx tutorial      # For MLX debugging
mflux-debug-pytorch tutorial  # For PyTorch debugging
```

**Critical reminders:**
- âœ… **`continue` polls automatically** - NEVER use `sleep` commands!
- âœ… **CLI handles all session management** - Don't manually manage servers or use curl
- âœ… **Fixed unique ports** - MLX=8000, PyTorch=8001 (can run simultaneously)

## ðŸš¨ BEFORE Starting Any Debugging Session

**For basics:** Run the interactive tutorial first: `mflux-debug-mlx tutorial`

**For advanced features:** Read the full README:
ðŸ“– **`src/mflux_debugger/README.md`**

Pay special attention to:
- **"Core Philosophy"** section - Interactive Debugging Over Scripts
- **"MLX Lazy Evaluation"** - Essential for MLX debugging  
- **"Model Porting Guide"** - Working backwards strategy
- **"Live Debugging Lessons Learned"** - Real-world debugging sessions

## Key Principles

1. **DO NOT write comparison/verification scripts** unless explicitly requested
2. **Use the interactive debugger** to inspect the real code instead
3. **Run the tutorial first** to learn basic commands hands-on

## ðŸš¨ Advanced Debugging Patterns

### NO SLEEP COMMANDS!

**âŒ WRONG Usage:**
```bash
# DON'T DO THIS - sleep is unnecessary!
mflux-debug-mlx continue &
sleep 30
mflux-debug-mlx status
```

**âœ… CORRECT Usage:**
```bash
# continue polls automatically every 2s
mflux-debug-mlx continue
# When it returns, you're at a breakpoint - inspect immediately!
```

### Parallel Debugging (Multiple Sessions)

**âœ… CORRECT - Sequential with automatic polling:**
```bash
# Start both sessions
mflux-debug-pytorch start script1.py
mflux-debug-mlx start script2.py

# Set breakpoints for both
mflux-debug-pytorch break /path/file.py 100
mflux-debug-mlx break /path/file.py 100

# Run one, wait for breakpoint (polls automatically)
mflux-debug-pytorch continue
# When this returns, you're at a breakpoint!

# Inspect PyTorch
mflux-debug-pytorch eval "tensor.shape"

# Run the other, wait for breakpoint
mflux-debug-mlx continue
# When this returns, you're at a breakpoint!

# Inspect MLX
mflux-debug-mlx eval "array.shape"

# Compare results
```

**âŒ WRONG - Background jobs with sleep:**
```bash
# DON'T DO THIS!
(mflux-debug-pytorch continue > /tmp/log &) && (mflux-debug-mlx continue > /tmp/log2 &) && sleep 60
```

### Key Technical Points

1. **`continue` blocks until a breakpoint is hit** (or timeout, default 120s)
2. **Polling is AUTOMATIC** - checks status every 2 seconds
3. **Use `--max-wait` to adjust timeout** - e.g., `--max-wait 180` for slow model loading
4. **Sequential execution is fine** - one session waits, then the other
5. **Don't use `&` to background** - defeats automatic polling

---

**Run `mflux-debug-mlx tutorial` to learn interactively, then see README for advanced features.**
